{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/edit-pdf/components/PdfCanvas.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useEffect, useRef, useState } from \"react\";\n\ninterface PdfCanvasProps {\n  pdfFile: File | null;\n  currentPage: number;\n  onTotalPages: (total: number) => void;\n}\n\nconst PdfCanvas: React.FC<PdfCanvasProps> = ({\n  pdfFile,\n  currentPage,\n  onTotalPages,\n}) => {\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const [pdfDoc, setPdfDoc] = useState<any>(null);\n  const scale = 1.5; \n\n  useEffect(() => {\n    if (!pdfFile) {\n        setPdfDoc(null);\n        if(containerRef.current) containerRef.current.innerHTML = \"\";\n        return;\n    };\n    const reader = new FileReader();\n    reader.onload = async () => {\n      const pdfjsLib = await import(\"pdfjs-dist/build/pdf\");\n      pdfjsLib.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjsLib.version}/pdf.worker.min.js`;\n      \n      const data = new Uint8Array(reader.result as ArrayBuffer);\n      try {\n        const doc = await pdfjsLib.getDocument({ data }).promise;\n        setPdfDoc(doc);\n        onTotalPages(doc.numPages);\n      } catch (error) {\n        console.error(\"Error loading PDF document:\", error);\n      }\n    };\n    reader.readAsArrayBuffer(pdfFile);\n  }, [pdfFile, onTotalPages]);\n\n  useEffect(() => {\n    if (!pdfDoc || !containerRef.current) return;\n\n    const renderPage = async () => {\n      try {\n        const page = await pdfDoc.getPage(currentPage);\n        const viewport = page.getViewport({ scale });\n\n        const canvas = document.createElement(\"canvas\");\n        const ctx = canvas.getContext(\"2d\");\n        if (!ctx) return;\n        \n        canvas.width = viewport.width;\n        canvas.height = viewport.height;\n\n        containerRef.current!.innerHTML = \"\";\n        containerRef.current!.appendChild(canvas);\n\n        await page.render({ canvasContext: ctx, viewport }).promise;\n      } catch (error) {\n        console.error(`Error rendering page ${currentPage}:`, error);\n      }\n    };\n\n    renderPage();\n  }, [pdfDoc, currentPage, scale]);\n\n  return (\n    <div\n      ref={containerRef}\n      className=\"w-full h-full flex justify-center items-center p-4 overflow-auto\"\n    />\n  );\n};\n\nexport default PdfCanvas;\n"],"names":[],"mappings":";;;;AAGA;;;AAFA;;AAUA,MAAM,YAAsC,CAAC,EAC3C,OAAO,EACP,WAAW,EACX,YAAY,EACb;;IACC,MAAM,eAAe,CAAA,GAAA,6JAAA,CAAA,SAAM,AAAD,EAAyB;IACnD,MAAM,CAAC,QAAQ,UAAU,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAO;IAC1C,MAAM,QAAQ;IAEd,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;+BAAE;YACR,IAAI,CAAC,SAAS;gBACV,UAAU;gBACV,IAAG,aAAa,OAAO,EAAE,aAAa,OAAO,CAAC,SAAS,GAAG;gBAC1D;YACJ;;YACA,MAAM,SAAS,IAAI;YACnB,OAAO,MAAM;uCAAG;oBACd,MAAM,WAAW;oBACjB,SAAS,mBAAmB,CAAC,SAAS,GAAG,CAAC,wCAAwC,EAAE,SAAS,OAAO,CAAC,kBAAkB,CAAC;oBAExH,MAAM,OAAO,IAAI,WAAW,OAAO,MAAM;oBACzC,IAAI;wBACF,MAAM,MAAM,MAAM,SAAS,WAAW,CAAC;4BAAE;wBAAK,GAAG,OAAO;wBACxD,UAAU;wBACV,aAAa,IAAI,QAAQ;oBAC3B,EAAE,OAAO,OAAO;wBACd,QAAQ,KAAK,CAAC,+BAA+B;oBAC/C;gBACF;;YACA,OAAO,iBAAiB,CAAC;QAC3B;8BAAG;QAAC;QAAS;KAAa;IAE1B,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;+BAAE;YACR,IAAI,CAAC,UAAU,CAAC,aAAa,OAAO,EAAE;YAEtC,MAAM;kDAAa;oBACjB,IAAI;wBACF,MAAM,OAAO,MAAM,OAAO,OAAO,CAAC;wBAClC,MAAM,WAAW,KAAK,WAAW,CAAC;4BAAE;wBAAM;wBAE1C,MAAM,SAAS,SAAS,aAAa,CAAC;wBACtC,MAAM,MAAM,OAAO,UAAU,CAAC;wBAC9B,IAAI,CAAC,KAAK;wBAEV,OAAO,KAAK,GAAG,SAAS,KAAK;wBAC7B,OAAO,MAAM,GAAG,SAAS,MAAM;wBAE/B,aAAa,OAAO,CAAE,SAAS,GAAG;wBAClC,aAAa,OAAO,CAAE,WAAW,CAAC;wBAElC,MAAM,KAAK,MAAM,CAAC;4BAAE,eAAe;4BAAK;wBAAS,GAAG,OAAO;oBAC7D,EAAE,OAAO,OAAO;wBACd,QAAQ,KAAK,CAAC,CAAC,qBAAqB,EAAE,YAAY,CAAC,CAAC,EAAE;oBACxD;gBACF;;YAEA;QACF;8BAAG;QAAC;QAAQ;QAAa;KAAM;IAE/B,qBACE,6LAAC;QACC,KAAK;QACL,WAAU;;;;;;AAGhB;GAjEM;KAAA;uCAmES","debugId":null}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/edit-pdf/components/Sidebar.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useEffect, useState } from \"react\";\n\ninterface SidebarProps {\n  pdfFile: File | null;\n  currentPage: number;\n  onPageClick: (pageNum: number) => void;\n  totalPages: number;\n}\n\nconst Sidebar: React.FC<SidebarProps> = ({ pdfFile, currentPage, onPageClick, totalPages }) => {\n  const [thumbnails, setThumbnails] = useState<string[]>([]);\n\n  useEffect(() => {\n    if (!pdfFile) {\n        setThumbnails([]);\n        return;\n    };\n\n    const reader = new FileReader();\n    reader.onload = async () => {\n      const data = new Uint8Array(reader.result as ArrayBuffer);\n      const pdfjsLib = await import(\"pdfjs-dist/build/pdf\");\n      pdfjsLib.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjsLib.version}/pdf.worker.min.js`;\n\n      const pdf = await pdfjsLib.getDocument({ data }).promise;\n      const thumbs: string[] = [];\n\n      for (let i = 1; i <= pdf.numPages; i++) {\n        const page = await pdf.getPage(i);\n        const viewport = page.getViewport({ scale: 0.5 });\n\n        const canvas = document.createElement(\"canvas\");\n        const ctx = canvas.getContext(\"2d\")!;\n        canvas.width = viewport.width;\n        canvas.height = viewport.height;\n\n        await page.render({ canvasContext: ctx, viewport }).promise;\n        thumbs.push(canvas.toDataURL());\n      }\n\n      setThumbnails(thumbs);\n    };\n\n    reader.readAsArrayBuffer(pdfFile);\n  }, [pdfFile]);\n\n  return (\n    <div className=\"w-full overflow-y-auto bg-white border-r h-full p-2\">\n      <div className=\"font-bold text-center mb-2\">文件預覽</div>\n      {thumbnails.length > 0 ? (\n        thumbnails.map((src, index) => (\n          <div\n            key={index}\n            className={`m-2 border-2 rounded-lg cursor-pointer transition-all ${\n              currentPage === index + 1 ? \"border-blue-500 ring-2 ring-blue-300\" : \"border-gray-300 hover:border-blue-400\"\n            }`}\n            onClick={() => onPageClick(index + 1)}\n          >\n            <img src={src} alt={`Page ${index + 1}`} className=\"w-full rounded-md\" />\n            <div className=\"text-center text-sm py-1 bg-gray-100 rounded-b-md\">p.{index + 1}</div>\n          </div>\n        ))\n      ) : (\n        <div className=\"text-center text-gray-500 mt-4\">沒有載入的檔案</div>\n      )}\n    </div>\n  );\n};\n\nexport default Sidebar;\n"],"names":[],"mappings":";;;;AAGA;;;AAFA;;AAWA,MAAM,UAAkC,CAAC,EAAE,OAAO,EAAE,WAAW,EAAE,WAAW,EAAE,UAAU,EAAE;;IACxF,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAY,EAAE;IAEzD,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;6BAAE;YACR,IAAI,CAAC,SAAS;gBACV,cAAc,EAAE;gBAChB;YACJ;;YAEA,MAAM,SAAS,IAAI;YACnB,OAAO,MAAM;qCAAG;oBACd,MAAM,OAAO,IAAI,WAAW,OAAO,MAAM;oBACzC,MAAM,WAAW;oBACjB,SAAS,mBAAmB,CAAC,SAAS,GAAG,CAAC,wCAAwC,EAAE,SAAS,OAAO,CAAC,kBAAkB,CAAC;oBAExH,MAAM,MAAM,MAAM,SAAS,WAAW,CAAC;wBAAE;oBAAK,GAAG,OAAO;oBACxD,MAAM,SAAmB,EAAE;oBAE3B,IAAK,IAAI,IAAI,GAAG,KAAK,IAAI,QAAQ,EAAE,IAAK;wBACtC,MAAM,OAAO,MAAM,IAAI,OAAO,CAAC;wBAC/B,MAAM,WAAW,KAAK,WAAW,CAAC;4BAAE,OAAO;wBAAI;wBAE/C,MAAM,SAAS,SAAS,aAAa,CAAC;wBACtC,MAAM,MAAM,OAAO,UAAU,CAAC;wBAC9B,OAAO,KAAK,GAAG,SAAS,KAAK;wBAC7B,OAAO,MAAM,GAAG,SAAS,MAAM;wBAE/B,MAAM,KAAK,MAAM,CAAC;4BAAE,eAAe;4BAAK;wBAAS,GAAG,OAAO;wBAC3D,OAAO,IAAI,CAAC,OAAO,SAAS;oBAC9B;oBAEA,cAAc;gBAChB;;YAEA,OAAO,iBAAiB,CAAC;QAC3B;4BAAG;QAAC;KAAQ;IAEZ,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,WAAU;0BAA6B;;;;;;YAC3C,WAAW,MAAM,GAAG,IACnB,WAAW,GAAG,CAAC,CAAC,KAAK,sBACnB,6LAAC;oBAEC,WAAW,CAAC,sDAAsD,EAChE,gBAAgB,QAAQ,IAAI,yCAAyC,yCACrE;oBACF,SAAS,IAAM,YAAY,QAAQ;;sCAEnC,6LAAC;4BAAI,KAAK;4BAAK,KAAK,CAAC,KAAK,EAAE,QAAQ,GAAG;4BAAE,WAAU;;;;;;sCACnD,6LAAC;4BAAI,WAAU;;gCAAoD;gCAAG,QAAQ;;;;;;;;mBAPzE;;;;0CAWT,6LAAC;gBAAI,WAAU;0BAAiC;;;;;;;;;;;;AAIxD;GA1DM;KAAA;uCA4DS","debugId":null}},
    {"offset": {"line": 229, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/edit-pdf/components/PdfEditor.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useRef, useState } from \"react\";\nimport PdfCanvas from \"./PdfCanvas\";\nimport Sidebar from \"./Sidebar\";\nimport type { Canvas } from \"fabric\";\n\nconst PdfEditor = () => {\n  const [pdfFile, setPdfFile] = useState<File | null>(null);\n  const [totalPages, setTotalPages] = useState(0);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [toolMode, setToolMode] = useState<\"select\" | \"text\" | \"draw\" | \"rect\">(\"select\");\n  const [color, setColor] = useState(\"#000000\");\n  const canvasRef = useRef<Canvas | null>(null);\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0] || null;\n    setPdfFile(file);\n    setCurrentPage(1);\n    setTotalPages(0);\n  };\n\n  return (\n    <div className=\"flex w-full h-screen bg-gray-100\">\n      <div className=\"w-[280px] flex-shrink-0\">\n        <Sidebar\n          pdfFile={pdfFile}\n          currentPage={currentPage}\n          onPageClick={setCurrentPage}\n          totalPages={totalPages}\n        />\n      </div>\n\n      <div className=\"flex-1 flex flex-col p-4\">\n        <div className=\"flex items-center gap-4 mb-4\">\n          <input type=\"file\" accept=\"application/pdf\" onChange={handleFileChange} className=\"bg-white p-2 rounded border\" />\n          <button onClick={() => setToolMode(\"select\")} className=\"px-4 py-2 bg-white rounded border\">選取</button>\n          <button onClick={() => setToolMode(\"text\")} className=\"px-4 py-2 bg-white rounded border\">文字</button>\n          <button onClick={() => setToolMode(\"draw\")} className=\"px-4 py-2 bg-white rounded border\">手繪</button>\n          <button onClick={() => setToolMode(\"rect\")} className=\"px-4 py-2 bg-white rounded border\">矩形</button>\n          <input\n            type=\"color\"\n            value={color}\n            onChange={(e) => setColor(e.target.value)}\n            title=\"選擇顏色\"\n            className=\"w-10 h-10\"\n          />\n        </div>\n\n        <div className=\"flex-grow bg-gray-200 rounded-lg shadow-inner overflow-hidden\">\n          {pdfFile ? (\n            <PdfCanvas\n              pdfFile={pdfFile}\n              currentPage={currentPage}\n              onTotalPages={setTotalPages}\n            />\n          ) : (\n             <div className=\"flex items-center justify-center h-full text-gray-500\">\n                請上傳一個 PDF 檔案以開始編輯\n             </div>\n          )}\n        </div>\n\n        {pdfFile && totalPages > 0 && (\n          <div className=\"flex justify-center items-center mt-4 gap-4\">\n            <button\n              onClick={() => setCurrentPage((prev) => Math.max(prev - 1, 1))}\n              disabled={currentPage <= 1}\n              className=\"px-4 py-2 bg-white rounded border disabled:opacity-50\"\n            >\n              上一頁\n            </button>\n            <span>第 {currentPage} / {totalPages} 頁</span>\n            <button\n              onClick={() => setCurrentPage((prev) => Math.min(prev + 1, totalPages))}\n              disabled={currentPage >= totalPages}\n               className=\"px-4 py-2 bg-white rounded border disabled:opacity-50\"\n            >\n              下一頁\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default PdfEditor;\n"],"names":[],"mappings":";;;;AAGA;AACA;AACA;;;AAJA;;;;AAOA,MAAM,YAAY;;IAChB,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAe;IACpD,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAC7C,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAC/C,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAuC;IAC9E,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACnC,MAAM,YAAY,CAAA,GAAA,6JAAA,CAAA,SAAM,AAAD,EAAiB;IAExC,MAAM,mBAAmB,CAAC;QACxB,MAAM,OAAO,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,IAAI;QACpC,WAAW;QACX,eAAe;QACf,cAAc;IAChB;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC,sJAAA,CAAA,UAAO;oBACN,SAAS;oBACT,aAAa;oBACb,aAAa;oBACb,YAAY;;;;;;;;;;;0BAIhB,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAM,MAAK;gCAAO,QAAO;gCAAkB,UAAU;gCAAkB,WAAU;;;;;;0CAClF,6LAAC;gCAAO,SAAS,IAAM,YAAY;gCAAW,WAAU;0CAAoC;;;;;;0CAC5F,6LAAC;gCAAO,SAAS,IAAM,YAAY;gCAAS,WAAU;0CAAoC;;;;;;0CAC1F,6LAAC;gCAAO,SAAS,IAAM,YAAY;gCAAS,WAAU;0CAAoC;;;;;;0CAC1F,6LAAC;gCAAO,SAAS,IAAM,YAAY;gCAAS,WAAU;0CAAoC;;;;;;0CAC1F,6LAAC;gCACC,MAAK;gCACL,OAAO;gCACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;gCACxC,OAAM;gCACN,WAAU;;;;;;;;;;;;kCAId,6LAAC;wBAAI,WAAU;kCACZ,wBACC,6LAAC,wJAAA,CAAA,UAAS;4BACR,SAAS;4BACT,aAAa;4BACb,cAAc;;;;;iDAGf,6LAAC;4BAAI,WAAU;sCAAwD;;;;;;;;;;;oBAM3E,WAAW,aAAa,mBACvB,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCACC,SAAS,IAAM,eAAe,CAAC,OAAS,KAAK,GAAG,CAAC,OAAO,GAAG;gCAC3D,UAAU,eAAe;gCACzB,WAAU;0CACX;;;;;;0CAGD,6LAAC;;oCAAK;oCAAG;oCAAY;oCAAI;oCAAW;;;;;;;0CACpC,6LAAC;gCACC,SAAS,IAAM,eAAe,CAAC,OAAS,KAAK,GAAG,CAAC,OAAO,GAAG;gCAC3D,UAAU,eAAe;gCACxB,WAAU;0CACZ;;;;;;;;;;;;;;;;;;;;;;;;AAQb;GA9EM;KAAA;uCAgFS","debugId":null}},
    {"offset": {"line": 437, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/edit-pdf/page.tsx"],"sourcesContent":["\"use client\";\n\nimport PdfEditor from \"./components/PdfEditor\";\n\nexport default function EditPdfPage() {\n  return <PdfEditor />;\n}\n"],"names":[],"mappings":";;;;AAEA;AAFA;;;AAIe,SAAS;IACtB,qBAAO,6LAAC,wJAAA,CAAA,UAAS;;;;;AACnB;KAFwB","debugId":null}}]
}